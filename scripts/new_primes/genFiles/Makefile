# DO NOT EDIT! generated by ./autogen

SCC=gcc
CC=clang -O0 -g -march=native -mtune=native -std=gnu99 -pedantic -Wall -Wextra -Wno-language-extension-token -fwrapv -DTIMECOP -DGETRANDOM

default: generic 2048

all: default timecop

generic: testrandom.out

2048: costpoly2048.out checkct2048untuned bench2048untuned test2048.out \
checkct2048mults bench2048mults \
checkct2048cycles bench2048cycles \
ubench2048 umults2048

timecop: \
checkct2048untuned checkct2048mults checkct2048cycles \

	valgrind ./checkct2048untuned
	valgrind ./checkct2048mults
	valgrind ./checkct2048cycles

# ----- benchmarks:

checkct2048cycles: checkct.c \
libhighctidh_2048.a libhighctidh_base.a libhighctidh_tunecycles2048.a libtest.a
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-o checkct2048cycles checkct.c \
		libhighctidh_2048.a libhighctidh_base.a libhighctidh_tunecycles2048.a libtest.a

checkct2048mults: checkct.c \
libhighctidh_2048.a libhighctidh_base.a libhighctidh_tunemults2048.a libtest.a
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-o checkct2048mults checkct.c \
		libhighctidh_2048.a libhighctidh_base.a libhighctidh_tunemults2048.a libtest.a

checkct2048untuned: checkct.c \
libhighctidh_2048.a libhighctidh_base.a libhighctidh_untuned.a libtest.a
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-o checkct2048untuned checkct.c \
		libhighctidh_2048.a libhighctidh_base.a libhighctidh_untuned.a libtest.a

bench2048cycles: bench.c \
libhighctidh_2048.a libhighctidh_base.a libhighctidh_tunecycles2048.a libtest.a
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-o bench2048cycles bench.c \
		libhighctidh_2048.a libhighctidh_base.a libhighctidh_tunecycles2048.a libtest.a

bench2048mults: bench.c \
libhighctidh_2048.a libhighctidh_base.a libhighctidh_tunemults2048.a libtest.a
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-o bench2048mults bench.c \
		libhighctidh_2048.a libhighctidh_base.a libhighctidh_tunemults2048.a libtest.a

bench2048untuned: bench.c \
libhighctidh_2048.a libhighctidh_base.a libhighctidh_untuned.a libtest.a
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-o bench2048untuned bench.c \
		libhighctidh_2048.a libhighctidh_base.a libhighctidh_untuned.a libtest.a

# ----- tests run automatically:

testrandom.out: testrandom
	[ -f testrandom.time ] && cat testrandom.time || :
	time ./testrandom > testrandom.out
	cmp testrandom.out testrandom.exp

testrandom: testrandom.o libhighctidh_base.a libtest.a
	$(CC) -o testrandom testrandom.o libhighctidh_base.a libtest.a

testrandom.o: testrandom.c random.h Makefile
	$(CC) -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-c testrandom.c

test2048: test.c \
libhighctidh_2048.a libhighctidh_base.a libhighctidh_untuned.a libtest.a
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-o test2048 test.c \
		libhighctidh_2048.a libhighctidh_base.a libhighctidh_untuned.a libtest.a

test2048.out: test2048 test2048.exp
	[ -f test2048.time ] && cat test2048.time || :
	time ./test2048 > test2048.out
	cmp test2048.out test2048.exp

# ----- microbenchmarks (some run automatically):

costpoly2048.out: costpoly2048
	./costpoly2048 > costpoly2048.out
	cmp costpoly2048.out costpoly.py

costpoly2048: costpoly.c \
libhighctidh_2048.a libhighctidh_base.a libtest.a
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-o costpoly2048 costpoly.c \
		libhighctidh_2048.a libhighctidh_base.a libtest.a

umults2048: umults.c \
libhighctidh_2048.a libhighctidh_base.a libhighctidh_untuned.a libtest.a
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-o umults2048 umults.c \
		libhighctidh_2048.a libhighctidh_base.a libhighctidh_untuned.a libtest.a

ubench2048: ubench.c \
libhighctidh_2048.a libhighctidh_base.a libhighctidh_untuned.a libtest.a
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-o ubench2048 ubench.c \
		libhighctidh_2048.a libhighctidh_base.a libhighctidh_untuned.a libtest.a

# ----- libhighctidh_tune{mults,cycles}:

libhighctidh_tunemults2048.a: steps_tunemults2048.o Makefile
	ar cr libhighctidh_tunemults2048.a steps_tunemults2048.o
	ranlib libhighctidh_tunemults2048.a

steps_tunemults2048.o: steps_tunemults2048.c steps.h Makefile
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-c steps_tunemults2048.c

steps_tunemults2048.c: tunemults2048.out tune2c Makefile
	./tune2c < tunemults2048.out > steps_tunemults2048.c

tunemults2048.out: tunemults2048 Makefile
	[ -f tunemults2048.time ] && cat tunemults2048.time || :
	time ./tunemults2048 > tunemults2048.out

tunemults2048: tunemults.c \
libhighctidh_2048.a libhighctidh_base.a libhighctidh_untuned.a libtest.a
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-o tunemults2048 tunemults.c \
		libhighctidh_2048.a libhighctidh_base.a libhighctidh_untuned.a libtest.a

libhighctidh_tunecycles2048.a: steps_tunecycles2048.o Makefile
	ar cr libhighctidh_tunecycles2048.a steps_tunecycles2048.o
	ranlib libhighctidh_tunecycles2048.a

steps_tunecycles2048.o: steps_tunecycles2048.c steps.h Makefile
	$(CC) -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-c steps_tunecycles2048.c

steps_tunecycles2048.c: tunecycles2048.out tune2c Makefile
	./tune2c < tunecycles2048.out > steps_tunecycles2048.c

tunecycles2048.out: tunecycles2048 Makefile
	[ -f tunecycles2048.time ] && cat tunecycles2048.time || :
	time ./tunecycles2048 > tunecycles2048.out

tunecycles2048: tunecycles.c \
libhighctidh_2048.a libhighctidh_base.a libhighctidh_untuned.a libtest.a
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-o tunecycles2048 tunecycles.c \
		libhighctidh_2048.a libhighctidh_base.a libhighctidh_untuned.a libtest.a

# ----- libhighctidh_{2048}, size-dependent functions:

libhighctidh_2048.a: uintbig2048.o fp2048.o fp_inv2048.o fp_sqrt2048.o primes2048.o poly2048.o mont2048.o elligator2048.o skgen2048.o validate2048.o csidh2048.o Makefile
	ar cr libhighctidh_2048.a uintbig2048.o fp2048.o fp_inv2048.o fp_sqrt2048.o primes2048.o poly2048.o mont2048.o elligator2048.o skgen2048.o validate2048.o csidh2048.o
	ranlib libhighctidh_2048.a

csidh2048.o:  Makefile
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-o csidh2048.o -c csidh.c

validate2048.o:  Makefile
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-o validate2048.o -c validate.c

skgen2048.o:  Makefile
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-o skgen2048.o -c skgen.c

elligator2048.o:  Makefile
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-o elligator2048.o -c elligator.c

mont2048.o:  Makefile
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-o mont2048.o -c mont.c

poly2048.o:  Makefile
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-o poly2048.o -c poly.c

fp_inv2048.o:  Makefile
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-c fp_inv2048.c

fp_sqrt2048.o:  Makefile
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-c fp_sqrt2048.c

primes2048.o:  Makefile
	$(CC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-c primes2048.c

fp2048.o: fp2048.S fp.h fp_namespace.h uintbig.h uintbig_namespace.h Makefile
	$(SCC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-c fp2048.S

uintbig2048.o: uintbig2048.S uintbig.h uintbig_namespace.h Makefile
	$(SCC) -DBITS=2048 -D'NAMESPACEBITS(x)=highctidh_2048_##x' -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-c uintbig2048.S

# ----- libhighctidh_untuned, size-independent but normally replaced by tuned functions:

libhighctidh_untuned.a: steps_untuned.o Makefile
	ar cr libhighctidh_untuned.a steps_untuned.o
	ranlib libhighctidh_untuned.a

steps_untuned.o: steps_untuned.c steps.h Makefile
	$(CC) -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-c steps_untuned.c

# ----- libhighctidh_base, size-independent functions:

libhighctidh_base.a: steps.o random.o Makefile
	ar cr libhighctidh_base.a steps.o random.o
	ranlib libhighctidh_base.a

steps.o: steps.c steps.h Makefile
	$(CC) -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-c steps.c

random.o: random.c random.h int32_sort.h randombytes.h Makefile
	$(CC) -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-c random.c

# ----- functions that libhighctidh wants from a core crypto library:

libtest.a: randombytes.o int32_sort.o Makefile
	ar cr libtest.a  randombytes.o int32_sort.o
	ranlib libtest.a

randombytes.o: randombytes.c randombytes.h Makefile
	$(CC) -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-c randombytes.c

int32_sort.o: int32_sort.c int32_sort.h Makefile
	$(CC) -D'NAMESPACEGENERIC(x)=highctidh_##x' \
		-c int32_sort.c

